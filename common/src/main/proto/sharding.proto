syntax = "proto3";
option java_multiple_files = true;
package com.graph.dist.proto;

message Node {
  int32 id = 1;
  int32 x = 2;
  int32 y = 3;
}

// Edges are directed. The shard of the 'from' node
// is implied by the shard data containing this edge.
message Edge {
  int32 from = 1;
  int32 to = 2;
  int32 to_shard = 3;
  int32 weight = 4;
}

message ShardData {
  int32 shard_id = 1;
  repeated Node nodes = 2;
  repeated Edge edges = 3;
}

message ShardRequest {
  int32 worker_id = 1;
}

message ShortestPathRequest {
  int32 queryId = 1;
  int32 startNode = 2;
  int32 endNode = 3;
}

message ShortestPathResponse {
    int32 distance = 1;
    repeated int32 nodes = 2;
}

message UpdateShortestPathRequest {
  int32 queryId = 1;
  int32 fromNode = 2;
  int32 fromShard = 3;
  int32 toNode = 4;
  int32 distance = 5;
}

message UpdateShortestPathResponse {
  bool success = 1;
}

service GraphService {
  rpc SolveShortestPath(ShortestPathRequest) returns (ShortestPathResponse);
  rpc UpdateShortestPath(UpdateShortestPathRequest) returns (UpdateShortestPathResponse);
}

service LeaderService {
    rpc GetShard(ShardRequest) returns (ShardData);
}